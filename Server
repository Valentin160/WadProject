//references:https://stackoverflow.com/questions/27599614/var-express-requireexpress-var-app-express-what-is-express-is-it
//biblioraphy:https://www.w3schools.com/nodejs/ref_path.asp
//references:https://stackoverflow.com/questions/7067966/why-doesnt-adding-cors-headers-to-an-options-route-allow-browsers-to-access-my


var express = require('express')//provides the require function, whose job is to load modules and give you access to their exports, we also called the variable express
var path = require('path');
const cors = require('cors')
var fs=require('fs')
var bodyParser=require('body-parser');
var app = express()

app.use(cors());
app.use(bodyParser.json())
app.use(bodyParser.urlencoded({ extended: true }));


jsondata=fs.readFileSync("discountLists");
listOfDiscounts=JSON.parse(jsondata);


app.get('/',function(req,res){
    res.sendfile(path.join(__dirname+'/Front.html'));
});


app.post('/', function(req, res) {
    var defaultDiscount="0%"//discount-ul default o sa fie 0%
    for (i = 0; i < listOfDiscounts.length; i++) {
        if (listOfDiscounts[i].brand.toLowerCase() == req.body.firma.toLowerCase() && listOfDiscounts[i].price == req.body.pret) {//checks if we find in json heslected brand and price
            defaultDiscount = listOfDiscounts[i].discount// if we find a combination, we modify the defult discount with the one we founded
        }
    }
    res.json({discount: defaultDiscount})//we send the brand to the client
});

app.post('/contact',function (req,res) {//receives data from the client(the contact me function)
    fs.appendFile(path.join(__dirname+'/Emails'), req.body.email+'\n', function(err) {
        if(err) {
            return console.log(err);
        }
    });
    res.json({email: req.body.email})//we send back to the client
});

app.listen(3000);